From ab5e521ac7607b9e191f9be0b96e3764a948b999 Mon Sep 17 00:00:00 2001
From: Cat73 <1901803382@qq.com>
Date: Tue, 12 Apr 2016 13:27:57 +0800
Subject: [PATCH] Cat73 -> mc-dev imports-fix
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

MC 反编译结果可能有些错误需要修复，或有一些简单到不值得专门创建一个 Patch 的小优化，这个 Patch 专门用于做这些事。
Link: https://github.com/PaperMC/Paper/blob/fb74f6dbfd9d38f0425dc93618071be0cfc73b63/Spigot-Server-Patches/0003-MC-Dev-fixes.patch
Link: https://github.com/PaperMC/Paper/blob/cd3d8fb27e4a6717146bf7256f37034285a303d7/Spigot-Server-Patches/0109-Prevent-possible-infinite-loop-in-BlockPosition-iter.patch

diff --git a/src/main/java/net/minecraft/server/BaseBlockPosition.java b/src/main/java/net/minecraft/server/BaseBlockPosition.java
index e54e7b7..913e720 100644
--- a/src/main/java/net/minecraft/server/BaseBlockPosition.java
+++ b/src/main/java/net/minecraft/server/BaseBlockPosition.java
@@ -87,7 +87,7 @@ public class BaseBlockPosition implements Comparable<BaseBlockPosition> {
         return Objects.toStringHelper(this).add("x", this.getX()).add("y", this.getY()).add("z", this.getZ()).toString();
     }
 
-    public int compareTo(Object object) {
-        return this.i((BaseBlockPosition) object);
+    public int compareTo(BaseBlockPosition object) {
+        return this.i(object);
     }
 }
diff --git a/src/main/java/net/minecraft/server/BlockPosition.java b/src/main/java/net/minecraft/server/BlockPosition.java
index e7a95f3..0b6ddfd 100644
--- a/src/main/java/net/minecraft/server/BlockPosition.java
+++ b/src/main/java/net/minecraft/server/BlockPosition.java
@@ -139,23 +139,23 @@ public class BlockPosition extends BaseBlockPosition {
 
                     protected BlockPosition a() {
                         if (this.b == null) {
-                            this.b = blockposition;
+                            this.b = blockposition2;
                             return this.b;
-                        } else if (this.b.equals(blockposition1)) {
+                        } else if (this.b.equals(blockposition3)) {
                             return (BlockPosition) this.endOfData();
                         } else {
                             int i = this.b.getX();
                             int j = this.b.getY();
                             int k = this.b.getZ();
 
-                            if (i < blockposition1.getX()) {
+                            if (i < blockposition3.getX()) {
                                 ++i;
-                            } else if (j < blockposition1.getY()) {
-                                i = blockposition.getX();
+                            } else if (j < blockposition3.getY()) {
+                                i = blockposition2.getX();
                                 ++j;
-                            } else if (k < blockposition1.getZ()) {
-                                i = blockposition.getX();
-                                j = blockposition.getY();
+                            } else if (k < blockposition3.getZ()) {
+                                i = blockposition2.getX();
+                                j = blockposition2.getY();
                                 ++k;
                             }
 
@@ -187,23 +187,23 @@ public class BlockPosition extends BaseBlockPosition {
 
                     protected BlockPosition.MutableBlockPosition a() {
                         if (this.b == null) {
-                            this.b = new BlockPosition.MutableBlockPosition(blockposition.getX(), blockposition.getY(), blockposition.getZ());
+                            this.b = new BlockPosition.MutableBlockPosition(blockposition2.getX(), blockposition2.getY(), blockposition2.getZ());
                             return this.b;
-                        } else if (this.b.equals(blockposition1)) {
+                        } else if (this.b.equals(blockposition3)) {
                             return (BlockPosition.MutableBlockPosition) this.endOfData();
                         } else {
                             int i = this.b.getX();
                             int j = this.b.getY();
                             int k = this.b.getZ();
 
-                            if (i < blockposition1.getX()) {
+                            if (i < blockposition3.getX()) {
                                 ++i;
-                            } else if (j < blockposition1.getY()) {
-                                i = blockposition.getX();
+                            } else if (j < blockposition3.getY()) {
+                                i = blockposition2.getX();
                                 ++j;
-                            } else if (k < blockposition1.getZ()) {
-                                i = blockposition.getX();
-                                j = blockposition.getY();
+                            } else if (k < blockposition3.getZ()) {
+                                i = blockposition2.getX();
+                                j = blockposition2.getY();
                                 ++k;
                             }
 
diff --git a/src/main/java/net/minecraft/server/BlockStateList.java b/src/main/java/net/minecraft/server/BlockStateList.java
index 8df8b04..5af47d0 100644
--- a/src/main/java/net/minecraft/server/BlockStateList.java
+++ b/src/main/java/net/minecraft/server/BlockStateList.java
@@ -83,22 +83,15 @@ public class BlockStateList {
         if (!BlockStateList.a.matcher(s).matches()) {
             throw new IllegalArgumentException("Block: " + block.getClass() + " has invalidly named property: " + s);
         } else {
-            Iterator iterator = iblockstate.c().iterator();
+            for (T t : iblockstate.c()) {
+                String s1 = iblockstate.a(t);
 
-            String s1;
-
-            do {
-                if (!iterator.hasNext()) {
-                    return s;
+                if (!a.matcher(s1).matches()) {
+                    throw new IllegalArgumentException("Block: " + block.getClass() + " has property: " + s + " with invalidly named value: " + s1);
                 }
-
-                Comparable comparable = (Comparable) iterator.next();
-
-                s1 = iblockstate.a(comparable);
-            } while (BlockStateList.a.matcher(s1).matches());
-
-            throw new IllegalArgumentException("Block: " + block.getClass() + " has property: " + s + " with invalidly named value: " + s1);
+            }
         }
+        return s;
     }
 
     public ImmutableList<IBlockData> a() {
@@ -154,7 +147,7 @@ public class BlockStateList {
             if (!this.b.containsKey(iblockstate)) {
                 throw new IllegalArgumentException("Cannot get property " + iblockstate + " as it does not exist in " + this.a.t());
             } else {
-                return (Comparable) iblockstate.b().cast(this.b.get(iblockstate));
+                return iblockstate.b().cast(this.b.get(iblockstate));
             }
         }
 
-- 
2.8.0.windows.1

