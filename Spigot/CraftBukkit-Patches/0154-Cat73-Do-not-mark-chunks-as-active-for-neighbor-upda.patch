From bda01ece7d92f3a25f6d033510f1a72d7e7c9dd7 Mon Sep 17 00:00:00 2001
From: Cat73 <1901803382@qq.com>
Date: Tue, 6 Dec 2016 15:24:12 +0800
Subject: [PATCH] Cat73 -> Do not mark chunks as active for neighbor updates
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

不要在更新临近区块的时候加载区块
Link: https://github.com/PaperMC/Paper/blob/ebf1094ea5dea6f3c8ad0ed5a1344089cb7ecfc7/Spigot-Server-Patches/0138-Do-not-mark-chunks-as-active-for-neighbor-updates.patch

diff --git a/src/main/java/net/minecraft/server/Chunk.java b/src/main/java/net/minecraft/server/Chunk.java
index 2e5a644a..8e9a7118 100644
--- a/src/main/java/net/minecraft/server/Chunk.java
+++ b/src/main/java/net/minecraft/server/Chunk.java
@@ -944,25 +944,26 @@ public class Chunk {
         }
         // CraftBukkit end
 
-        Chunk chunk = ichunkprovider.getLoadedChunkAt(this.locX, this.locZ - 1);
-        Chunk chunk1 = ichunkprovider.getLoadedChunkAt(this.locX + 1, this.locZ);
-        Chunk chunk2 = ichunkprovider.getLoadedChunkAt(this.locX, this.locZ + 1);
-        Chunk chunk3 = ichunkprovider.getLoadedChunkAt(this.locX - 1, this.locZ);
+        final ChunkProviderServer chunkprovider = (ChunkProviderServer) ichunkprovider;
+        Chunk chunk = chunkprovider.getChunkIfLoaded(this.locX, this.locZ - 1);
+        Chunk chunk1 = chunkprovider.getChunkIfLoaded(this.locX + 1, this.locZ);
+        Chunk chunk2 = chunkprovider.getChunkIfLoaded(this.locX, this.locZ + 1);
+        Chunk chunk3 = chunkprovider.getChunkIfLoaded(this.locX - 1, this.locZ);
 
-        if (chunk1 != null && chunk2 != null && ichunkprovider.getLoadedChunkAt(this.locX + 1, this.locZ + 1) != null) {
+        if (chunk1 != null && chunk2 != null && chunkprovider.getChunkIfLoaded(this.locX + 1, this.locZ + 1) != null) {
             this.a(chunkgenerator);
         }
 
-        if (chunk3 != null && chunk2 != null && ichunkprovider.getLoadedChunkAt(this.locX - 1, this.locZ + 1) != null) {
+        if (chunk3 != null && chunk2 != null && chunkprovider.getChunkIfLoaded(this.locX - 1, this.locZ + 1) != null) {
             chunk3.a(chunkgenerator);
         }
 
-        if (chunk != null && chunk1 != null && ichunkprovider.getLoadedChunkAt(this.locX + 1, this.locZ - 1) != null) {
+        if (chunk != null && chunk1 != null && chunkprovider.getChunkIfLoaded(this.locX + 1, this.locZ - 1) != null) {
             chunk.a(chunkgenerator);
         }
 
         if (chunk != null && chunk3 != null) {
-            Chunk chunk4 = ichunkprovider.getLoadedChunkAt(this.locX - 1, this.locZ - 1);
+            Chunk chunk4 = chunkprovider.getChunkIfLoaded(this.locX - 1, this.locZ - 1);
 
             if (chunk4 != null) {
                 chunk4.a(chunkgenerator);
-- 
2.11.0.windows.1

