From 57b754ce17dbad8f016a1d595a86674fdfebb836 Mon Sep 17 00:00:00 2001
From: Cat73 <root@cat73.org>
Date: Wed, 26 Feb 2020 13:57:44 +0800
Subject: [PATCH] Cat73 -> Optimize RegistryMaterials
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

使用更大的初始容量创建容器

Link: https://github.com/PaperMC/Paper/blob/892f479fb4ef849ba834cbedd0069395cc1bef14/Spigot-Server-Patches/0286-Optimize-RegistryMaterials.patch

diff --git a/src/main/java/net/minecraft/server/RegistryMaterials.java b/src/main/java/net/minecraft/server/RegistryMaterials.java
index 2d6a7b3a..8477febc 100644
--- a/src/main/java/net/minecraft/server/RegistryMaterials.java
+++ b/src/main/java/net/minecraft/server/RegistryMaterials.java
@@ -16,8 +16,8 @@ import org.apache.logging.log4j.Logger;
 public class RegistryMaterials<T> extends IRegistryWritable<T> {
 
     protected static final Logger LOGGER = LogManager.getLogger();
-    protected final RegistryID<T> b = new RegistryID<>(256);
-    protected final BiMap<MinecraftKey, T> c = HashBiMap.create();
+    protected final RegistryID<T> b = new RegistryID<>(2048); // Paper - use bigger expected size to reduce collisions
+    protected final BiMap<MinecraftKey, T> c = HashBiMap.create(2048); // Paper - use bigger expected size to reduce collisions
     protected Object[] d;
     private int V;
 
@@ -101,6 +101,6 @@ public class RegistryMaterials<T> extends IRegistryWritable<T> {
             this.d = collection.toArray(new Object[collection.size()]);
         }
 
-        return this.d[random.nextInt(this.d.length)];
+        return (T) this.d[random.nextInt(this.d.length)]; // Paper - Decompile fix
     }
 }
-- 
2.25.0

