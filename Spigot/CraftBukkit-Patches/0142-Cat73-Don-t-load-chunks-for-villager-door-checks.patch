From a66e952fa629a3ef179c99a121c6eff87863c8b4 Mon Sep 17 00:00:00 2001
From: Cat73 <cat7373x@gmail.com>
Date: Sat, 16 Jun 2018 09:01:37 +0800
Subject: [PATCH] Cat73 -> Don't load chunks for villager door checks
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

不要在村庄检测门时加载区块
Link: https://github.com/PaperMC/Paper/blob/4f29a0ce0a470ae3ac6be1d69ee7843a78bb9ae1/Spigot-Server-Patches/0300-Don-t-load-chunks-for-villager-door-checks.patch

diff --git a/src/main/java/net/minecraft/server/PersistentVillage.java b/src/main/java/net/minecraft/server/PersistentVillage.java
index a5b79eca..3efa440a 100644
--- a/src/main/java/net/minecraft/server/PersistentVillage.java
+++ b/src/main/java/net/minecraft/server/PersistentVillage.java
@@ -226,7 +226,12 @@ public class PersistentVillage extends PersistentBase {
     }
 
     private boolean f(BlockPosition blockposition) {
-        IBlockData iblockdata = this.world.getType(blockposition);
+        // Paper start
+        IBlockData iblockdata = this.world.getTypeIfLoaded(blockposition);
+        if (iblockdata == null) {
+            return false;
+        }
+        // Paper end
         Block block = iblockdata.getBlock();
 
         return block instanceof BlockDoor ? iblockdata.getMaterial() == Material.WOOD : false;
-- 
2.15.2 (Apple Git-101.1)

