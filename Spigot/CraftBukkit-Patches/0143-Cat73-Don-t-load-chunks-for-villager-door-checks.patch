From 82eaec73c7873b25eb2f9ed756d3404de660c918 Mon Sep 17 00:00:00 2001
From: Cat73 <cat7373x@gmail.com>
Date: Sat, 16 Jun 2018 09:01:37 +0800
Subject: [PATCH] Cat73 -> Don't load chunks for villager door checks
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

不要在村庄检测门时加载区块
Link: https://github.com/PaperMC/Paper/blob/f0cb089a24d6c62f986e6635975f80b96c517e92/Spigot-Server-Patches/0300-Don-t-load-chunks-for-villager-door-checks.patch

diff --git a/src/main/java/net/minecraft/server/PersistentVillage.java b/src/main/java/net/minecraft/server/PersistentVillage.java
index a5b79eca..3efa440a 100644
--- a/src/main/java/net/minecraft/server/PersistentVillage.java
+++ b/src/main/java/net/minecraft/server/PersistentVillage.java
@@ -226,7 +226,12 @@ public class PersistentVillage extends PersistentBase {
     }
 
     private boolean f(BlockPosition blockposition) {
-        IBlockData iblockdata = this.world.getType(blockposition);
+        // Paper start
+        IBlockData iblockdata = this.world.getTypeIfLoaded(blockposition);
+        if (iblockdata == null) {
+            return false;
+        }
+        // Paper end
         Block block = iblockdata.getBlock();
 
         return block instanceof BlockDoor ? iblockdata.getMaterial() == Material.WOOD : false;
diff --git a/src/main/java/net/minecraft/server/Village.java b/src/main/java/net/minecraft/server/Village.java
index fb52785b..cd3eecef 100644
--- a/src/main/java/net/minecraft/server/Village.java
+++ b/src/main/java/net/minecraft/server/Village.java
@@ -327,7 +327,12 @@ public class Village {
     }
 
     private boolean f(BlockPosition blockposition) {
-        IBlockData iblockdata = this.a.getType(blockposition);
+        // Paper start
+        IBlockData iblockdata = this.a.getTypeIfLoaded(blockposition);
+        if (iblockdata == null) {
+            return false;
+        }
+        // Paper end
         Block block = iblockdata.getBlock();
 
         return block instanceof BlockDoor ? iblockdata.getMaterial() == Material.WOOD : false;
-- 
2.15.2 (Apple Git-101.1)

