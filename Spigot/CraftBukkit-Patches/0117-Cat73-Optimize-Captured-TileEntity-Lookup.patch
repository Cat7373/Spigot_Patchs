From 90508512a31159e85c2995870634cbafa339a833 Mon Sep 17 00:00:00 2001
From: Cat73 <root@cat73.org>
Date: Wed, 26 Feb 2020 13:48:25 +0800
Subject: [PATCH] Cat73 -> Optimize Captured TileEntity Lookup
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

由于 Value 不可能为 null，因此不需要先 containsKey 再 get

Link: https://github.com/PaperMC/Paper/blob/892f479fb4ef849ba834cbedd0069395cc1bef14/Spigot-Server-Patches/0365-Optimize-Captured-TileEntity-Lookup.patch

diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java
index e1bcd834..67a3581e 100644
--- a/src/main/java/net/minecraft/server/World.java
+++ b/src/main/java/net/minecraft/server/World.java
@@ -852,12 +852,13 @@ public abstract class World implements GeneratorAccess, AutoCloseable {
             return null;
         } else {
             // CraftBukkit start
-            if (capturedTileEntities.containsKey(blockposition)) {
-                return capturedTileEntities.get(blockposition);
+            TileEntity tileentity = null; // Paper
+            if (!capturedTileEntities.isEmpty() && (tileentity = capturedTileEntities.get(blockposition)) != null) { // Paper
+                return tileentity; // Paper
             }
             // CraftBukkit end
 
-            TileEntity tileentity = null;
+            // TileEntity tileentity = null; // Paper
 
             if (this.tickingTileEntities) {
                 tileentity = this.e(blockposition);
-- 
2.25.0

